{
  "version": 3,
  "sources": [
    "unknown"
  ],
  "names": [
    "cc",
    "Class",
    "extends",
    "Component",
    "properties",
    "_charge",
    "_title",
    "_btnOK",
    "_btnCancel",
    "_editbox",
    "_content",
    "_rateTxt",
    "_chargeCnt",
    "_rate",
    "_costRMB",
    "_MINCOST",
    "_MAXCOSTRMB",
    "_payParam",
    "onLoad",
    "vv",
    "initUI",
    "refreshInfo",
    "chargeType",
    "find",
    "getComponent",
    "Button",
    "EditBox",
    "onCloseBtnClicked",
    "console",
    "log",
    "string",
    "active",
    "wc",
    "hide",
    "onConfirmBtnClicked",
    "flag",
    "validateIntNum",
    "str",
    "alert",
    "show",
    "fn",
    "ret",
    "sendChargeRequest",
    "userMgr",
    "refreshTime",
    "data",
    "account",
    "sign",
    "userid",
    "userId",
    "costRMB",
    "ship_type",
    "http",
    "sendRequest",
    "bind",
    "chargerate",
    "Number",
    "val",
    "patten",
    "test",
    "url",
    "xhr",
    "loader",
    "getXMLHttpRequest",
    "open",
    "setRequestHeader",
    "onreadystatechange",
    "readyState",
    "status",
    "httpStatus",
    "statusText",
    "response",
    "JSON",
    "parse",
    "responseText",
    "errmsg",
    "errcode",
    "sys",
    "isNative",
    "window",
    "pay",
    "timeout",
    "req",
    "stringify",
    "send"
  ],
  "mappings": "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",
  "file": "unknown",
  "sourcesContent": [
    "cc.Class({\n    extends: cc.Component,\n    properties: {\n        _charge: null,\n        // 标题\n        _title: null,\n        // 确认按钮\n        _btnOK: null,\n        // 取消按钮\n        _btnCancel: null,\n        // 输入框\n        _editbox: null,\n        // 显示输入的金币数量\n        _content: null,\n        // 显示兑换率\n        _rateTxt: null,\n        _chargeCnt: null,\n        _rate: 1,\n        _costRMB: 0,\n        // 最少充值数量\n        _MINCOST: 1,\n        _MAXCOSTRMB: 99999,\n        _payParam: null\n    },\n    // use this for initialization\n    onLoad: function() {\n        if (cc.vv == null) {\n            return;\n        }\n        this.initUI()\n            //FIXME:  当前的兑换率是\n        this.refreshInfo();\n        cc.vv.chargeType = this;\n    },\n    initUI: function() {\n        this._charge = cc.find(\"Canvas/zuanshiChange\");\n        this._btnOK = cc.find(\"Canvas/zuanshiChange/yes\").getComponent(cc.Button);\n        this._btnCancel = cc.find(\"Canvas/zuanshiChange/no\").getComponent(cc.Button);\n        this._editbox = cc.find(\"Canvas/zuanshiChange/editbox\").getComponent(cc.EditBox);\n    },\n    onCloseBtnClicked: function() {\n        console.log(\"关闭界面\");\n        this._editbox.string = \"\";\n        this._charge.active = false;\n        cc.vv.wc.hide();\n    },\n    onConfirmBtnClicked: function() {\n        this.refreshInfo();\n        // 验证是不是整数，不是整数要求重新输入\n        console.log(\"金额是\", this._costRMB);\n        var flag = this.validateIntNum(this._costRMB)\n        if (!flag) {\n            var str = \"请输入整数金额,且最小充值金额\" + this._MINCOST + \"元\";\n            cc.vv.alert.show(\"注意\", str);\n        } else {\n            var fn = function(ret) {\n                cc.vv.wc.hide();\n                if (ret == null) {\n                    cc.vv.alert.show(\"注意\", \"充值失败请稍后重试\");\n                    return;\n                }\n                this.sendChargeRequest(ret);\n                cc.vv.wc.show(\"正在充值，请稍后\");\n                cc.vv.userMgr.refreshTime = 2000;\n            };\n            var data = {\n                account: cc.vv.userMgr.account,\n                sign: cc.vv.userMgr.sign,\n                userid: cc.vv.userMgr.userId,\n                costRMB: this._costRMB,\n                ship_type: 1\n            };\n            cc.vv.wc.show(\"正在充值，请稍后\");\n            cc.vv.http.sendRequest(\"/go_to_charge\", data, fn.bind(this));\n        }\n    },\n    show: function() {\n        this._charge.active = true;\n    },\n    refreshInfo: function() {\n        this._rate = 1 || cc.vv.userMgr.chargerate;\n        this._costRMB = Number(this._editbox.string);\n        console.log('this.cost', this._costRMB);\n        // this._chargeCnt = (this._chargeCnt * this._rate).toFixed(0);\n        // if (!this._costRMB) {\n        //     this._content.string = \"您当前未输入充值金额\";\n        // } else {\n        //     this._content.string = \"您输入的金额是:\" + this._costRMB;\n        // }\n    },\n    // 判断是不是输入的正确的金额\n    validateIntNum: function(val) {\n        var patten = /^[1-9]\\d*$/;\n        var flag = patten.test(val)\n        if (!flag) {\n            return false;\n        } else {\n            console.log(\"当前输入的数字是正整数\", val, this._MINCOST);\n            return (val >= this._MINCOST);\n        }\n    },\n    // 发送申请充值请求\n    sendChargeRequest: function(data) {\n        if (data == null) {\n            cc.vv.alert.show(\"注意\", \"充值失败请稍后重试\");\n            return;\n        }\n        console.log(\"发送 充值请求\");\n        var url = data.url;\n        var xhr = cc.loader.getXMLHttpRequest();\n        xhr.open(\"POST\", url, true);\n        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n        xhr.onreadystatechange = function() {\n            if (xhr.readyState == 4 && (xhr.status >= 200 && xhr.status <= 207)) {\n                var httpStatus = xhr.statusText;\n                var response = JSON.parse(xhr.responseText);\n                console.log(\"返回！！！！！\" + response.errmsg + \"response.errcode:\" + response.errcode);\n                if (response.errcode == 0) {\n                    var ret = response.errmsg;\n                    console.log(\"返回的结果是!!!!!!\" + ret);\n                    this._payParam = ret;\n                    if (!cc.sys.isNative) {\n                        console.log(\"是H5游戏\");\n                        window.pay(this._payParam);\n                    }\n                    // 接收完后，隐藏充值窗口\n                    this.onCloseBtnClicked();\n                } else {\n                    cc.vv.alert.show(\"注意\", \"充值失败请稍后重试\");\n                    cc.vv.wc.hide();\n                    console.log(\"返回的结果出错\");\n                }\n            } else {\n                console.log(\"无结果返回\");\n            }\n        }.bind(this);\n        xhr.timeout = 5000; // 5 seconds for timeout\n        var req = JSON.stringify(data)\n        xhr.send(req);\n    },\n});"
  ]
}