{
  "version": 3,
  "sources": [
    "unknown"
  ],
  "names": [
    "cc",
    "Class",
    "extends",
    "Component",
    "properties",
    "_lastTouchTime",
    "_voice",
    "_volume",
    "_voice_failed",
    "_lastCheckTime",
    "_timeBar",
    "MAX_TIME",
    "_voiceTime",
    "onLoad",
    "find",
    "active",
    "scaleX",
    "i",
    "children",
    "length",
    "btnVoice",
    "vv",
    "utils",
    "addClickEvent",
    "node",
    "self",
    "on",
    "Node",
    "EventType",
    "TOUCH_START",
    "console",
    "log",
    "voiceMgr",
    "prepare",
    "Date",
    "now",
    "TOUCH_MOVE",
    "TOUCH_END",
    "cancel",
    "release",
    "onVoiceOK",
    "TOUCH_CANCEL",
    "sendVoice",
    "window",
    "voice",
    "serverId",
    "net",
    "send",
    "msg",
    "time",
    "onBtnOKClicked",
    "update",
    "dt",
    "v",
    "getVoiceLevel",
    "percent"
  ],
  "mappings": "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",
  "file": "unknown",
  "sourcesContent": [
    "cc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,      // The default value will be used only when the component attaching\r\n        //                           to a node for the first time\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        _lastTouchTime: null,\r\n        _voice: null,\r\n        _volume: null,\r\n        _voice_failed: null,\r\n        _lastCheckTime: -1,\r\n        _timeBar: null,\r\n        MAX_TIME: 15000,\r\n        _voiceTime: null,\r\n    },\r\n    // use this for initialization\r\n    onLoad: function() {\r\n        this._voice = cc.find(\"Canvas/voice\");\r\n        this._voice.active = false;\r\n        this._voice_failed = cc.find(\"Canvas/voice/voice_failed\");\r\n        this._voice_failed.active = false;\r\n        this._timeBar = cc.find(\"Canvas/voice/time\");\r\n        this._timeBar.scaleX = 0.0;\r\n        this._volume = cc.find(\"Canvas/voice/volume\");\r\n        for (var i = 1; i < this._volume.children.length; ++i) {\r\n            this._volume.children[i].active = false;\r\n        }\r\n        var btnVoice = cc.find(\"Canvas/voice/voice_failed/btn_ok\");\r\n        if (btnVoice) {\r\n            cc.vv.utils.addClickEvent(btnVoice, this.node, \"Voice\", \"onBtnOKClicked\");\r\n        }\r\n        var self = this;\r\n        var btnVoice = cc.find(\"Canvas/btn_voice\");\r\n        if (btnVoice) {\r\n            btnVoice.on(cc.Node.EventType.TOUCH_START, function() {\r\n                console.log(\"cc.Node.EventType.TOUCH_START\");\r\n                // 关掉所有音乐\r\n                cc.vv.voiceMgr.prepare(\"record.amr\");\r\n                self._lastTouchTime = Date.now();\r\n                self._voice.active = true;\r\n                self._voice_failed.active = false;\r\n            });\r\n            btnVoice.on(cc.Node.EventType.TOUCH_MOVE, function() {\r\n                console.log(\"cc.Node.EventType.TOUCH_MOVE\");\r\n            });\r\n            btnVoice.on(cc.Node.EventType.TOUCH_END, function() {\r\n                console.log(\"cc.Node.EventType.TOUCH_END\");\r\n                if (Date.now() - self._lastTouchTime < 1000) {\r\n                    self._voice_failed.active = true;\r\n                    cc.vv.voiceMgr.cancel();\r\n                } else {\r\n                    // 录音结束并上传\r\n                    cc.vv.voiceMgr.release();\r\n                    self.onVoiceOK();\r\n                }\r\n            });\r\n            btnVoice.on(cc.Node.EventType.TOUCH_CANCEL, function() {\r\n                console.log(\"cc.Node.EventType.TOUCH_CANCEL\");\r\n                cc.vv.voiceMgr.cancel();\r\n                this._voice.active = false;\r\n                self._lastTouchTime = null;\r\n                self._voice.active = false;\r\n            });\r\n        }\r\n    },\r\n    onVoiceOK: function() {\r\n        console.log(\"onVoiceOK!!!!\" + this._lastTouchTime);\r\n        this._voice.active = false;\r\n        if (this._lastTouchTime != null) {\r\n            this._voiceTime = Date.now() - this._lastTouchTime;\r\n            console.log('时长是多少' + this._voiceTime);\r\n        }\r\n        self._lastTouchTime = null;\r\n    },\r\n    // 发送语音到服务器\r\n    sendVoice: function() {\r\n        if (window.voice.serverId && this._voiceTime) {\r\n            console.log(\"发送语音消息到服务器\");\r\n            cc.vv.net.send(\"voice_msg\", {\r\n                msg: window.voice.serverId,\r\n                time: this._voiceTime\r\n            });\r\n        }\r\n        this._voiceTime = null;\r\n        window.voice.serverId = null;\r\n    },\r\n    onBtnOKClicked: function() {\r\n        this._voice.active = false;\r\n    },\r\n    // called every frame, uncomment this function to activate update callback\r\n    update: function(dt) {\r\n        if (this._voice.active == true && this._voice_failed.active == false) {\r\n            if (Date.now() - this._lastCheckTime > 300) {\r\n                for (var i = 0; i < this._volume.children.length; ++i) {\r\n                    this._volume.children[i].active = false;\r\n                }\r\n                var v = cc.vv.voiceMgr.getVoiceLevel(7);\r\n                if (v >= 1 && v <= 7) {\r\n                    this._volume.children[v - 1].active = true;\r\n                }\r\n                this._lastCheckTime = Date.now();\r\n            }\r\n        }\r\n        if (this._lastTouchTime) {\r\n            var time = Date.now() - this._lastTouchTime;\r\n            if (time >= this.MAX_TIME) {\r\n                cc.vv.voiceMgr.release();\r\n                this.onVoiceOK();\r\n                this._voice.active = false;\r\n                this._lastTouchTime = null;\r\n            } else {\r\n                var percent = time / this.MAX_TIME;\r\n                this._timeBar.scaleX = 1 - percent;\r\n            }\r\n        };\r\n        if (window.voice && window.voice.serverId != null) {\r\n            console.log(\"id是多少\" + window.voice.serverId);\r\n            this.sendVoice();\r\n        };\r\n    },\r\n});"
  ]
}