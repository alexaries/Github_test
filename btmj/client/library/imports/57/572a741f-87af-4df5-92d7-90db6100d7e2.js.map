{
  "version": 3,
  "sources": [
    "unknown"
  ],
  "names": [
    "String",
    "prototype",
    "format",
    "args",
    "arguments",
    "length",
    "result",
    "key",
    "reg",
    "RegExp",
    "replace",
    "i",
    "undefined",
    "cc",
    "Class",
    "extends",
    "Component",
    "properties",
    "_stateStr",
    "_progress",
    "_isLoading",
    "btnWechatLogin",
    "Node",
    "loadingbar",
    "default",
    "type",
    "ProgressBar",
    "_time",
    "onLoad",
    "progress",
    "sys",
    "isNative",
    "isMobile",
    "cvs",
    "node",
    "getComponent",
    "Canvas",
    "fitHeight",
    "fitWidth",
    "initMgr",
    "vv",
    "http",
    "url",
    "master_url",
    "active",
    "start",
    "self",
    "SHOW_TIME",
    "FADE_TIME",
    "os",
    "OS_IOS",
    "t",
    "Date",
    "now",
    "fn",
    "dt",
    "setTimeout",
    "op",
    "checkVersion",
    "UserMgr",
    "require",
    "userMgr",
    "ReplayMgr",
    "replayMgr",
    "global",
    "net",
    "match_net",
    "GameNetMgr",
    "gameNetMgr",
    "AnysdkMgr",
    "anysdkMgr",
    "init",
    "VoiceMgr",
    "voiceMgr",
    "AudioMgr",
    "audioMgr",
    "Utils",
    "utils",
    "urlParse",
    "params",
    "window",
    "location",
    "name",
    "value",
    "str",
    "href",
    "num",
    "indexOf",
    "substr",
    "arr",
    "split",
    "substring",
    "onGetVersion",
    "ret",
    "version",
    "console",
    "log",
    "JSON",
    "stringify",
    "SI",
    "startPreloading",
    "xhr",
    "complete",
    "fnRequest",
    "sendRequest",
    "abort",
    "loader",
    "onProgress",
    "completedCount",
    "totalCount",
    "item",
    "loadResDir",
    "err",
    "assets",
    "onLoadComplete",
    "onComplete",
    "onBtnWeichatClicked",
    "sendWXLoginXHR",
    "wc",
    "show",
    "guestAuth",
    "getXMLHttpRequest",
    "open",
    "onreadystatechange",
    "readyState",
    "status",
    "httpStatus",
    "statusText",
    "response",
    "responseText",
    "res",
    "parse",
    "session_id",
    "errcode",
    "onLoginResp",
    "code",
    "uid",
    "roomid",
    "sid",
    "timeout",
    "send",
    "time",
    "update"
  ],
  "mappings": "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",
  "file": "unknown",
  "sourcesContent": [
    "String.prototype.format = function(args) {\r\n    if (arguments.length > 0) {\r\n        var result = this;\r\n        if (arguments.length == 1 && typeof(args) == \"object\") {\r\n            for (var key in args) {\r\n                var reg = new RegExp(\"({\" + key + \"})\", \"g\");\r\n                result = result.replace(reg, args[key]);\r\n            }\r\n        } else {\r\n            for (var i = 0; i < arguments.length; i++) {\r\n                if (arguments[i] == undefined) {\r\n                    return \"\";\r\n                } else {\r\n                    var reg = new RegExp(\"({[\" + i + \"]})\", \"g\");\r\n                    result = result.replace(reg, arguments[i]);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    } else {\r\n        return this;\r\n    }\r\n};\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        _stateStr: '',\r\n        _progress: 0.0,\r\n        _isLoading: true,\r\n        btnWechatLogin: cc.Node,\r\n        loadingbar: {\r\n            default: null,\r\n            type: cc.ProgressBar\r\n        },\r\n        _time: 0,\r\n        i: 0,\r\n    },\r\n    // use this for initialization\r\n    onLoad: function() {\r\n        this.loadingbar.progress = 0;\r\n        if (!cc.sys.isNative && cc.sys.isMobile) {\r\n            var cvs = this.node.getComponent(cc.Canvas);\r\n            cvs.fitHeight = true;\r\n            cvs.fitWidth = true;\r\n        }\r\n        this.initMgr();\r\n        if (!cc.vv) {\r\n            this.initMgr();\r\n        }\r\n        cc.vv.http.url = cc.vv.http.master_url;\r\n        this.btnWechatLogin.active = false;\r\n    },\r\n    start: function() {\r\n        var self = this;\r\n        var SHOW_TIME = 3000;\r\n        var FADE_TIME = 500;\r\n        if (cc.sys.os != cc.sys.OS_IOS || !cc.sys.isNative) {\r\n            var t = Date.now();\r\n            var fn = function() {\r\n                var dt = Date.now() - t;\r\n                if (dt < SHOW_TIME) {\r\n                    setTimeout(fn, 33);\r\n                } else {\r\n                    var op = (1 - ((dt - SHOW_TIME) / FADE_TIME)) * 255;\r\n                    if (op < 0) {\r\n                        self.checkVersion();\r\n                    } else {\r\n                        setTimeout(fn, 33);\r\n                    }\r\n                }\r\n            };\r\n            setTimeout(fn, 33);\r\n        } else {\r\n            this.checkVersion();\r\n        }\r\n    },\r\n    initMgr: function() {\r\n        cc.vv = {};\r\n        var UserMgr = require(\"UserMgr\");\r\n        cc.vv.userMgr = new UserMgr();\r\n        var ReplayMgr = require(\"ReplayMgr\");\r\n        cc.vv.replayMgr = new ReplayMgr();\r\n        cc.vv.http = require(\"HTTP\");\r\n        cc.vv.global = require(\"Global\");\r\n        cc.vv.net = require(\"Net\");\r\n        cc.vv.match_net = require(\"MatchNet\");\r\n        var GameNetMgr = require(\"GameNetMgr\");\r\n        cc.vv.gameNetMgr = new GameNetMgr();\r\n        // cc.vv.gameNetMgr.initHandlers();\r\n        var AnysdkMgr = require(\"AnysdkMgr\");\r\n        cc.vv.anysdkMgr = new AnysdkMgr();\r\n        cc.vv.anysdkMgr.init();\r\n        var VoiceMgr = require(\"VoiceMgr\");\r\n        cc.vv.voiceMgr = new VoiceMgr();\r\n        cc.vv.voiceMgr.init();\r\n        var AudioMgr = require(\"AudioMgr\");\r\n        cc.vv.audioMgr = new AudioMgr();\r\n        cc.vv.audioMgr.init();\r\n        var Utils = require(\"Utils\");\r\n        cc.vv.utils = new Utils();\r\n        cc.args = this.urlParse();\r\n        this._isLoading = true;\r\n    },\r\n    urlParse: function() {\r\n        var params = {};\r\n        if (window.location == null) {\r\n            return params;\r\n        }\r\n        var name, value;\r\n        var str = window.location.href; //取得整个地址栏\r\n        var num = str.indexOf(\"?\")\r\n        str = str.substr(num + 1); //取得所有参数   \r\n        var arr = str.split(\"&\"); //各个参数放到数组里\r\n        for (var i = 0; i < arr.length; i++) {\r\n            num = arr[i].indexOf(\"=\");\r\n            if (num > 0) {\r\n                name = arr[i].substring(0, num);\r\n                value = arr[i].substr(num + 1);\r\n                params[name] = value;\r\n            }\r\n        }\r\n        return params;\r\n    },\r\n    checkVersion: function() {\r\n        var self = this;\r\n        var onGetVersion = function(ret) {\r\n            if (ret.version == null) {\r\n                console.log(\"error.\");\r\n            } else {\r\n                console.log(\"返回的结果是\" + JSON.stringify(ret));\r\n                cc.vv.SI = ret;\r\n                self.startPreloading();\r\n            }\r\n        };\r\n        var xhr = null;\r\n        var complete = false;\r\n        var fnRequest = function() {\r\n            self._stateStr = \"正在连接服务器\";\r\n            xhr = cc.vv.http.sendRequest(\"/get_serverinfo\", null, function(ret) {\r\n                xhr = null;\r\n                complete = true;\r\n                onGetVersion(ret);\r\n            });\r\n            setTimeout(fn, 5000);\r\n        }\r\n        var fn = function() {\r\n            if (!complete) {\r\n                if (xhr) {\r\n                    xhr.abort();\r\n                    self._stateStr = \"连接失败，即将重试\";\r\n                    setTimeout(function() {\r\n                        fnRequest();\r\n                    }, 5000);\r\n                } else {\r\n                    fnRequest();\r\n                }\r\n            }\r\n        };\r\n        fn();\r\n    },\r\n    startPreloading: function() {\r\n        this._stateStr = \"正在加载资源，请稍候\";\r\n        // this._isLoading = true;\r\n        var self = this;\r\n        cc.loader.onProgress = function(completedCount, totalCount, item) {\r\n            if (self._isLoading) {\r\n                self._progress = completedCount / totalCount;\r\n            }\r\n        };\r\n        cc.loader.loadResDir(\"textures/images/login\", function(err, assets) {\r\n            console.log(\"登录资源加载完成\");\r\n            self.onLoadComplete();\r\n        });\r\n    },\r\n    // 加载完成\r\n    onLoadComplete: function() {\r\n        this._isLoading = false;\r\n        this.loadingbar.node.active = false;\r\n        this.btnWechatLogin.active = true;\r\n        cc.loader.onComplete = null;\r\n        cc.loader.loadResDir(\"textures/home\", function(err, assets) {\r\n            console.log(\"hall大厅资源加载完成\");\r\n        });\r\n    },\r\n    // 点击微信登录按钮\r\n    onBtnWeichatClicked: function() {\r\n        console.log(\"创建一个微信登录的\");\r\n        if (cc.args[\"account\"] == null) {\r\n            this.sendWXLoginXHR();\r\n        } else {\r\n            cc.vv.wc.show(\"正在登录游戏,请稍后\");\r\n            cc.vv.userMgr.guestAuth();\r\n        }\r\n    },\r\n    // 发送请求，获取到微信登录用的code\r\n    sendWXLoginXHR: function() {\r\n        cc.vv.wc.show(\"正在登录游戏,请稍后\");\r\n        var url = \"http://mj.yajugame.com/sessionid.php\";\r\n        var xhr = cc.loader.getXMLHttpRequest();\r\n        xhr.open(\"GET\", url, true);\r\n        xhr.onreadystatechange = function() {\r\n            if (xhr.readyState == 4 && (xhr.status >= 200 && xhr.status <= 207)) {\r\n                var httpStatus = xhr.statusText;\r\n                var response = xhr.responseText;\r\n                var res = JSON.parse(response)\r\n                this.session_id = res[\"sid\"];\r\n                if (this.session_id) {\r\n                    console.log(\"the sid is \" + this.session_id);\r\n                    var fn = function(ret) {\r\n                        if (ret.errcode == 0) {\r\n                            cc.vv.anysdkMgr.onLoginResp(ret.code, ret.uid, ret.roomid);\r\n                        } else {\r\n                            cc.vv.wc.show(\"请在微信中打开该链接地址或刷新页面！\");\r\n                        }\r\n                    }\r\n                    cc.vv.http.sendRequest(\"/get_wx_code\", {\r\n                        sid: this.session_id\r\n                    }, fn);\r\n                }\r\n            } else {\r\n                console.log(\"无结果返回\");\r\n            }\r\n        };\r\n        xhr.timeout = 5000; // 5 seconds for timeout\r\n        xhr.send();\r\n    },\r\n    time: function() {\r\n        this._time = Date.now();\r\n    },\r\n    update: function(dt) {\r\n        var progress = this.loadingbar.progress;\r\n        if (this._isLoading) {\r\n            if (Date.now() - this._time > 100) {\r\n                this.time();\r\n                progress += dt;\r\n                if (this.i >= 3) {\r\n                    if (progress < this._progress) {\r\n                        progress = this._progress;\r\n                    }\r\n                }\r\n                if (progress > 1) {\r\n                    progress = 1;\r\n                }\r\n                this.i++;\r\n            }\r\n            this.loadingbar.progress = progress;\r\n        }\r\n    }\r\n});"
  ]
}